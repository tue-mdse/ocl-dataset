[comment encoding = UTF-8 

Copyright (c) 2012 Obeo
All rights reserved.  This program and the accompanying materials
are made available under the terms of the Eclipse Public License 1.0
which accompanies this distribution, and is available at
http://www.eclipse.org/legal/epl-v10.html

You can apply any license to the files generated with this module and Acceleo.

Contributors :
	Mathieu Cartaud (Obeo) - initial API and implementation
/]
[module pomParentXmlFile('http://www.eclipse.org/emf/2002/Ecore', 'http://www.eclipse.org/emf/2002/GenModel', 'http://www.obeonetwork.org/dsl/eclipse')]

[import org::obeonetwork::dsl::gen::eclipse::common::normalizeName /]
[import org::obeonetwork::dsl::gen::eclipse::services::findModelBundle /]


[template private pomParentXmlFile(anApplication : Application)]
[anApplication.getTheBundleForModel()/]/pom.xml
[/template]

[template public genPomParentXmlFile(anApplication : Application)]
[file (anApplication.pomParentXmlFile(), false, 'UTF-8')]
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <prerequisites>
    <maven>3.0</maven>
  </prerequisites>

  <groupId>[anApplication.genApplicationID()/]</groupId>
  <artifactId>[anApplication.genParentID()/]</artifactId>
  <version>[anApplication.applicationVersion().substitute('.qualifier', '')/]-SNAPSHOT</version>
  <packaging>pom</packaging>
  <name>[anApplication.description/] Project</name>

  <licenses>
    <license>
      <name>Eclipse Public License v1.0</name>
      <comments>
	  [anApplication.copyright/]       
      </comments>
    </license>
  </licenses>
  
  <modules>
    [anApplication.modulesLocation()/]
  </modules>

  <properties>
    <acceleo-version>3.3.0-SNAPSHOT</acceleo-version>
    <tycho-version>0.17.0</tycho-version>
    <tycho-extras-version>0.17.0</tycho-extras-version>
    <acceleo-site>http://download.eclipse.org/modeling/m2t/acceleo/updates/interim/3.3/</acceleo-site>
	<orbit-site>http://download.eclipse.org/tools/orbit/downloads/drops/R20120526062928/repository/</orbit-site>
  </properties>

  <profiles>
    <profile>
      <id>platform-indigo</id>
      <activation>
         <activeByDefault>true</activeByDefault>
        <property>
          <name>platform-version-name</name>
          <value>indigo</value>
        </property>
      </activation>
      <properties>
        <eclipse-site>http://download.eclipse.org/releases/indigo</eclipse-site>
        <platform-version>['['/]3.7,3.8)</platform-version>
      </properties>
    </profile>
[if (anApplication.generateCheckStyle)]
	<profile>
        <id>checkstyle</id>
        <activation>
            <activeByDefault>false</activeByDefault>
        </activation>
        <build>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-checkstyle-plugin</artifactId>
                    <version>2.6</version>
                    <executions>
                        <execution>
                            <id>check my sources</id>
                            <goals>
                                <goal>checkstyle</goal>
                            </goals>
                            <phase>verify</phase>
                            <configuration>
                                <failOnErrors>false</failOnErrors>
                                <consoleOutput>true</consoleOutput>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </build>
    </profile>
[/if]
  </profiles>

  <dependencies>
     <dependency>
       <groupId>org.eclipse.acceleo</groupId>
       <artifactId>maven</artifactId>
       <version>3.2.1</version>
     </dependency>
     <dependency>
       <groupId>org.slf4j</groupId>
       <artifactId>slf4j-simple</artifactId>
       <version>1.6.4</version>
     </dependency>
   </dependencies>
  
  <repositories>
<!--[protected (': add your own repositories -->')]
    <repository>
      <id>eclipse-platform</id>
      <layout>p2</layout>
      <url>${eclipse-site}</url>
    </repository>
    <repository>
      <id>acceleo</id>
      <layout>p2</layout>
      <url>${acceleo-site}</url>
    </repository>
	<repository>
      <id>orbit</id>
      <layout>p2</layout>
      <url>${orbit-site}</url>
    </repository>
	<repository>
       <id>Indigo Release</id>
       <url>http://www.obeo.fr/download/acceleo/maven/releases/indigo</url>
     </repository>
     <repository>
       <id>Snapshots</id>
       <url>http://www.obeo.fr/download/acceleo/maven/snapshots</url>
     </repository>
<!--[/protected]-->
  </repositories>

  <pluginRepositories>
<!--[protected (': add your own pluginRepositories -->')]
    <pluginRepository>
       <id>Indigo Release</id>
       <url>http://www.obeo.fr/download/acceleo/maven/releases/indigo</url>
     </pluginRepository>
     <pluginRepository>
       <id>Snapshots</id>
       <url>http://www.obeo.fr/download/acceleo/maven/snapshots</url>
     </pluginRepository>
    <pluginRepository>
      <!-- need maven-findbugs-2.3.2-SNAPSHOT, see http://jira.codehaus.org/browse/MFINDBUGS-122 remove this when this version is released -->
      <id>codehaus.snapshots</id>
      <url>http://snapshots.repository.codehaus.org/</url>
    </pluginRepository>
<!--[/protected]-->
  </pluginRepositories>

  <build>
    <plugins>
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-maven-plugin</artifactId>
        <version>${tycho-version}</version>
        <extensions>true</extensions>
      </plugin>
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>target-platform-configuration</artifactId>
        <version>${tycho-version}</version>
        <configuration>
          <resolver>p2</resolver>
          <pomDependencies>consider</pomDependencies>
		   <environments>
<!--[protected (': choose your environments -->')]
            <environment>
              <os>linux</os>
              <ws>gtk</ws>
              <arch>x86</arch>
            </environment>
            <environment>
              <os>win32</os>
              <ws>win32</ws>
              <arch>x86</arch>
            </environment>
            <environment>
              <os>win32</os>
              <ws>win32</ws>
              <arch>x86_64</arch>
            </environment>
            <environment>
              <os>linux</os>
              <ws>gtk</ws>
              <arch>x86_64</arch>
            </environment>
            <environment>
              <os>macosx</os>
              <ws>cocoa</ws>
              <arch>x86_64</arch>
            </environment>
<!--[/protected]-->
          </environments>
        </configuration>
      </plugin>
[if (anApplication.eAllContents(Feature).generateSdkFeature->size() > 0)]
[anApplication.sdkPlugin()/]
[/if]
    </plugins>

    <pluginManagement>
      <plugins>
        <plugin>
          <groupId>org.eclipse.tycho</groupId>
          <artifactId>tycho-compiler-plugin</artifactId>
          <version>${tycho-version}</version>
          <configuration>
            <encoding>UTF-8</encoding>
          </configuration>
        </plugin>
        <plugin>
          <!-- TODO remove workaround when https://issues.sonatype.org/browse/TYCHO-473 is fixed -->
          <groupId>org.eclipse.tycho</groupId>
          <artifactId>tycho-source-plugin</artifactId>
          <version>${tycho-version}</version>
          <executions>
            <execution>
[if (anApplication.eAllContents(Feature).generateSdkFeature->size() > 0)]
              <id>attach-source</id>
              <phase>process-classes</phase>
              <goals>
                <goal>plugin-source</goal>
              </goals>
[/if]
            </execution>
          </executions>
        </plugin>
<!--[protected (': configure your plugins -->')]
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-resources-plugin</artifactId>
          <version>2.4.1</version>
          <configuration>
            <encoding>ISO-8859-1</encoding>
          </configuration>
        </plugin>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-antrun-plugin</artifactId>
          <version>1.3</version>
        </plugin>
		<plugin>
          <groupId>org.eclipse.acceleo</groupId>
         <artifactId>maven</artifactId>
         <version>3.2.1</version>
          <executions>
            <execution>
              <id>acceleo-compile</id>
              <phase>compile</phase>
              <goals>
                <goal>acceleo-compile</goal>
              </goals>
            </execution>
          </executions>
        </plugin>
<!--[/protected]-->
      </plugins>
    </pluginManagement>
  </build>

</project>
[/file]
[/template]

[template private modulesLocation(anApplication : Application) post(trim())]
[for (aBundle : Bundle | anApplication.eAllContents(Bundle))]
<module>../plugins/[aBundle.genBundleID()/]</module>
[/for]
[if (anApplication.generateTestsBundle)]
[for (aBundle : Bundle | anApplication.eAllContents(Bundle))]
<module>../tests/[aBundle.genBundleID()/].tests</module>
[/for]
[/if]
[for (aFeature : Feature | anApplication.eAllContents(Feature))]
<module>../features/[aFeature.genFeatureID()/]</module>
[/for]
[for (aRepository : Repository | anApplication.eAllContents(Repository))]
<module>../repositories/[aRepository.genRepositoryID()/]</module>
[/for]
[/template]

[template private sdkPlugin(anApplication : Application)]
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-source-plugin</artifactId>
        <version>${tycho-version}</version>
        <executions>
          <execution>
            <id>plugin-source</id>
            <goals>
              <goal>plugin-source</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>org.eclipse.tycho.extras</groupId>
        <artifactId>tycho-source-feature-plugin</artifactId>
        <version>${tycho-extras-version}</version>
        <executions>
          <execution>
            <id>source-feature</id>
            <phase>package</phase>
            <goals>
              <goal>source-feature</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-p2-plugin</artifactId>
        <version>${tycho-version}</version>
        <executions>
          <!-- These two should allow us not to get "duplicate artifact" warnings during the build. -->
          <execution>
            <!-- Don't attach (default) metadata before the source-feature execution.-->
            <id>default-p2-metadata-default</id>
            <configuration>
              <attachP2Metadata>false</attachP2Metadata>
            </configuration>
          </execution>
          <execution>
            <!-- Do attach metadata after the source-feature execution.-->
            <id>attach-p2-metadata</id>
            <goals>
              <goal>p2-metadata</goal>
            </goals>
            <phase>package</phase>
          </execution>
        </executions>
      </plugin>
[/template]